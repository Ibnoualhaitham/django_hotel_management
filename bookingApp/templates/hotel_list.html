{% extends 'navbar.html' %}
{% load static %}

{% block content %}
<style>
  .hotel-img {
    width: 100%;
    height: 220px;
    object-fit: cover;
    border-radius: 10px 10px 0 0;
    cursor: zoom-in;
    transition: transform 0.3s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }
  .hotel-img:hover {
    transform: scale(1.05);
  }
  .card {
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: box-shadow 0.3s ease;
  }
  .card:hover {
    box-shadow: 0 8px 24px rgba(0,0,0,0.2);
  }
  .badge-status {
    font-weight: 600;
    font-size: 0.85rem;
    padding: 0.3em 0.6em;
    border-radius: 0.5rem;
  }
  .btn-sm {
    font-size: 0.85rem;
  }
  .image-modal-img {
    border-radius: 10px;
    max-height: 80vh;
    object-fit: contain;
    width: 100%;
  }
</style>

<!-- IMAGE MODAL -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-body text-center p-0">
        <img id="modalImage" src="" alt="Hotel Image" class="image-modal-img" />
      </div>
    </div>
  </div>
</div>

<script>
  function showImageModal(url) {
    const img = document.getElementById('modalImage');
    img.src = url;
    const modal = new bootstrap.Modal(document.getElementById('imageModal'));
    modal.show();
  }
</script>

<div class="container mt-5">
  <h1 class="display-5 fw-bold text-center mb-4">Find your next stay</h1>

  {% if request.user.is_authenticated and request.user.is_staff %}
  <div class="mb-4 text-end">
    <a href="{% url 'hotel_create' %}" class="btn btn-primary">+ Add New Hotel</a>
  </div>
  {% endif %}

  {% if hotels %}
  <div class="row g-4">
    {% for hotel in hotels %}
    <div class="col-md-4">
      <div class="card h-100">
        {% with hotel.images.all|first as hotel_image %}
          {% if hotel_image %}
            <img src="{{ hotel_image.image.url }}" alt="{{ hotel.name }}" class="hotel-img" 
                onclick="showImageModal('{{ hotel_image.image.url }}')" loading="lazy">
          {% else %}
            {% static 'default_hotel.jpg' as default_img %}
            <img src="{{ default_img }}" alt="No image available" class="hotel-img" loading="lazy"
                onclick="showImageModal('{{ default_img }}')">
          {% endif %}
        {% endwith %}

        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ hotel.name }}</h5>
          <p class="text-muted small mb-1"><i class="bi bi-geo-alt-fill"></i> {{ hotel.address }}</p>
          <p class="small">{{ hotel.description|truncatechars:100 }}</p>

          <div class="d-flex align-items-center mb-2">
            <span class="badge bg-success me-2">
              â˜… {{ hotel.get_average_rating|default:"0"|floatformat:1 }}
            </span>
            <small class="text-muted">{{ hotel.review_set.count }} reviews</small>
          </div>

          <!-- Status badge -->
          {% if hotel.status == 'available' %}
            <span class="badge bg-primary badge-status">Available</span>
          {% elif hotel.status == 'booked' %}
            <span class="badge bg-secondary badge-status">Booked</span>
          {% elif hotel.status == 'under_maintenance' %}
            <span class="badge bg-warning text-dark badge-status">Under Maintenance</span>
          {% elif hotel.status == 'closed' %}
            <span class="badge bg-danger badge-status">Closed</span>
          {% endif %}

          {% if hotel.is_getaway_deal %}
            <div class="badge bg-warning text-dark mt-2 badge-status">Getaway Deal</div>
          {% endif %}

          <p class="mt-3 mb-1"><strong>{{ hotel.nights }} nights stay</strong></p>

          <p class="mb-3 small text-muted">
            <i class="bi bi-wifi"></i> Free Wi-Fi &nbsp; | &nbsp;
            <i class="bi bi-cup-hot"></i> Breakfast &nbsp; | &nbsp;
            <i class="bi bi-car-front"></i> Parking
          </p>

          <div class="mt-auto d-flex gap-2 flex-wrap">
            <a href="{% url 'hotel_detail' hotel.pk %}" class="btn btn-outline-primary btn-sm flex-fill">View Details</a>

            {% if hotel.status == 'available' %}
              <a href="{% url 'book_hotel' hotel.pk %}" class="btn btn-success btn-sm flex-fill">Book Now</a>
            {% else %}
              <button class="btn btn-secondary btn-sm flex-fill" disabled>Unavailable</button>
            {% endif %}

            {% if request.user.is_authenticated and request.user.is_staff %}
              <a href="{% url 'hotel_update' hotel.pk %}" class="btn btn-warning btn-sm flex-fill">Edit</a>
              <a href="{% url 'hotel_delete' hotel.pk %}" class="btn btn-outline-danger btn-sm flex-fill"
                 onclick="return confirm('Are you sure you want to delete this hotel?');">Delete</a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="text-center text-muted">No hotels found.</p>
  {% endif %}
</div>
{% endblock %}
